<link rel="import" href="../components/bower_components/polymer/polymer.html">

<link rel="import" href="../components/bower_components/iron-form/iron-form.html">
<link rel="import" href="../components/bower_components/paper-input/paper-input.html">
<link rel="import" href="../components/bower_components/paper-button/paper-button.html">
<link rel="import" href="../components/bower_components/paper-radio-group/paper-radio-group.html">

<link rel="import" href="my-prefered-lang.html">

<dom-module id="my-form">
<template>
	<form
		is="iron-form"
		id="ajax"
    	method="POST"
    	action="../../showCasePolymer-server-mvc/saveUser.json"
    	on-iron-form-submit="formSubmitted"
    	on-iron-form-error="formError"
    	on-iron-form-response="formResponse">
			
		<span>Les champs * sont obligatoires</span><br />

		<paper-input type="text" id="name" name="name" label="Nom*" value="{{user.name}}" maxlength="20" required pattern="^[a-zA-Z'àâéèêïôùûçÀÂÉÈÏÔÙÛÇ]+$"></paper-input>
		<paper-input type="text" id="surname" name="surname" label="Prénom*" value="{{user.surname}}" maxlength="20" required pattern="^[a-zA-Z'àâéèêïôùûçÀÂÉÈÏÔÙÛÇ]+$"></paper-input>
	    
		<paper-input type="email" id="email" name="email" label="email" value="{{user.email}}"></paper-input>
        
		<paper-input type="text" id="societe" name="societe" label="Société" value="{{user.soc}}"></paper-input>
		<paper-input type="text" id="fonction" name="fonction" label="fonction" value="{{user.fonction}}" pattern="^[a-zA-Z'àâéèêïôùûçÀÂÉÈÏÔÙÛÇ]+$" maxlength="20"></paper-input>
		<paper-input type="text" id="lieu" name="lieu" label="lieu" value="{{user.lieu}}"></paper-input>
        
		<my-prefered-lang selected="{{selectedPrefLang}}"></my-prefered-lang>
		<input type="hidden" name="prefLang" value="{{selectedPrefLang}}" />

		<paper-button raised id="submitButton" disabled?="{{submitButtonDisable==true}}" on-tap="formSubmit">{{submitButtonText}}</paper-button>
	</form>
</template>
<script>
Polymer({
	is: "my-form",
    ready: function () {
    	this.submitButtonText = "Enregistrer";
    	this.submitButtonDisable = false;
    },
    formSubmit: function() {
    	this.$.ajax.submit();
    },
    formSubmitted: function (event) {
 		this.submitButtonText = "sending datas..."; 
 		this.submitButtonDisable = true;
    },
    formResponse: function (event, detail) {
		this.submitButtonText = "Enregistrer";
		this.submitButtonDisable = false;
    	
		var response = detail;
		if (response.success) {
			var mess = response.data.name + " " + response.data.surname + " " + response.data.prefLang;
			this.fire('iron-signal', {name: "message-info", data: mess});
		} else {
			if (response.errors) {
				var message = "";
				for (var i = 0; i < response.errors.length; i++) {
					message = message + response.errors[i].errorMessage + "\r\n";
				}
				this.fire('iron-signal', {name: "message-error", data: message});
			}
		}
	},
	formError: function (event, detail) {
		this.submitButtonText = "Enregistrer";
		this.submitButtonDisable = false;
		
		var mess = detail.error;
		this.fire('iron-signal', {name: "message-error", data: mess});
	}
});
</script>
</dom-module>